import { serialize as serializeBSON, deserialize as deserializeBSON } from 'bson';
/* eslint-disable @typescript-eslint/no-unsafe-return */
const serialization = {
    serialize(data) {
        return serializeBSON(data);
    },
    async deserialize(data) {
        if (typeof data === 'string') {
            // we won't complain, just assume someone sent JSON
            return JSON.parse(data);
        }
        let buffer;
        if ('arrayBuffer' in data) {
            buffer = new Uint8Array(await data.arrayBuffer());
        }
        else if (data instanceof ArrayBuffer) {
            buffer = new Uint8Array(data);
        }
        else {
            buffer = data;
        }
        return deserializeBSON(buffer, { promoteBuffers: true });
    },
};
export default serialization;
//# sourceMappingURL=bson.js.map